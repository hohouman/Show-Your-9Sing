<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜¯9ä½†å”±</title>
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    
    <style>
        :root { --primary: #222; --accent: #0070f3; --bg: #fafafa; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, sans-serif;
            background: var(--bg); color: var(--primary);
            height: 100vh; display: flex; overflow: hidden;
        }

        /* --- ä¾§è¾¹æ  --- */
        .sidebar {
            width: 260px; background: #fff; border-right: 1px solid #eee;
            display: flex; flex-direction: column; flex-shrink: 0;
            z-index: 50;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .profile {
            padding: 30px 20px 20px 20px;
            text-align: center; 
            border-bottom: 1px solid #f5f5f5;
            background-color: #fff;
        }
        .avatar {
            width: 80px; height: 80px; border-radius: 50%;
            object-fit: cover; margin-bottom: 10px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .nickname { font-weight: bold; font-size: 1.1rem; margin-bottom: 8px;}
        
        .home-link {
            display: inline-block; font-size: 0.85rem; color: var(--accent);
            text-decoration: none; border: 1px solid var(--accent);
            padding: 4px 12px; border-radius: 20px; transition: all 0.2s;
        }
        .home-link:hover { background: var(--accent); color: #fff; }

        /* ä¾§è¾¹æ åˆ—è¡¨ï¼šæ»šåŠ¨æ¡å‡ºç°åœ¨ä¾§è¾¹æ çš„æœ€å³è¾¹ */
        .song-list { 
            flex: 1; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch; 
            
            /* ç¾åŒ–æ»šåŠ¨æ¡ */
            scrollbar-width: thin;
            scrollbar-color: #eee transparent;
        }
        
        .song-list::-webkit-scrollbar { width: 4px; }
        .song-list::-webkit-scrollbar-track { background: transparent; }
        .song-list::-webkit-scrollbar-thumb { background-color: #eee; border-radius: 4px; }
        .song-list::-webkit-scrollbar-thumb:hover { background-color: #ddd; }

        .song-item {
            padding: 16px 24px; cursor: pointer; font-size: 15px; color: #555;
            border-left: 3px solid transparent; transition: 0.2s;
        }
        .song-item:hover { background: #f4f4f4; color: #000; }
        .song-item.active { background: #e6f7ff; border-left-color: var(--accent); color: var(--accent); font-weight: 600; }

        .sidebar-footer {
            padding: 15px; text-align: center; border-top: 1px solid #f5f5f5;
            font-size: 0.8rem; background: #fff;
        }
        .repo-link {
            color: #999; text-decoration: none; transition: color 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .repo-link:hover { color: #333; }

        /* --- ä¸»åŒºåŸŸ (å…³é”®ä¿®æ”¹) --- */
        .main {
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
            /* å…³é”®ç‚¹ï¼šè®© .main è´Ÿè´£æ»šåŠ¨ï¼Œè¿™æ ·æ»šåŠ¨æ¡å°±åœ¨å±å¹•æœ€å³è¾¹ */
            overflow-y: auto; 
            overflow-x: hidden;
            height: 100vh; 
            position: relative; 
            width: 100%;
            
            /* ç¾åŒ–å³ä¾§ä¸»æ»šåŠ¨æ¡ */
            scrollbar-width: thin;
            scrollbar-color: #ddd transparent;
        }

        .main::-webkit-scrollbar { width: 8px; }
        .main::-webkit-scrollbar-track { background: transparent; }
        .main::-webkit-scrollbar-thumb { background-color: #ddd; border-radius: 4px; }
        .main::-webkit-scrollbar-thumb:hover { background-color: #ccc; }

        .menu-btn {
            display: none; position: absolute; left: 20px; top: 20px;
            z-index: 60; background: rgba(255,255,255,0.8);
            border: 1px solid #ddd; border-radius: 8px;
            padding: 8px; cursor: pointer; backdrop-filter: blur(5px);
        }

        /* é¡¶éƒ¨æ’­æ”¾å™¨ (å…³é”®ä¿®æ”¹) */
        .sticky-header {
            width: 100%; 
            max-width: 500px; 
            text-align: center;
            background: var(--bg); /* å¿…é¡»æœ‰èƒŒæ™¯è‰²ï¼Œå¦åˆ™æ­Œè¯ä¼šé€è§† */
            
            /* å…³é”®ç‚¹ï¼šæ¢å¤ stickyï¼Œè®©å®ƒå¸é™„åœ¨é¡¶éƒ¨ */
            position: sticky;
            top: 0;
            
            z-index: 10; 
            padding-top: 60px; 
            padding-bottom: 20px; 
            margin: 0 auto; /* ç¡®ä¿å±…ä¸­ */
        }
        
        h2 { margin-bottom: 20px; font-weight: normal; font-size: 1.6rem; padding: 0 10px; }
        audio { width: 90%; height: 40px; outline: none; }
        
        /* æ­Œè¯åŒºåŸŸ (å…³é”®ä¿®æ”¹) */
        .lyrics {
            /* ç§»é™¤ overflow-y: autoï¼Œä¸å†å†…éƒ¨æ»šåŠ¨ */
            width: 100%; 
            max-width: 500px;
            text-align: center; 
            line-height: 2.2; 
            color: #666; 
            white-space: pre-wrap; 
            
            /* åº•éƒ¨ç•™è¶³ç©ºé—´ï¼Œé˜²æ­¢æœ€åä¸€å¥è¢«é®æŒ¡ */
            padding: 20px 20px 100px 20px; 
            
            /* åªéœ€è¦åº•éƒ¨æ¸éšï¼Œé¡¶éƒ¨ç”± sticky header é®æŒ¡ */
            -webkit-mask-image: linear-gradient(to bottom, black 0%, black 90%, transparent 100%);
            mask-image: linear-gradient(to bottom, black 0%, black 90%, transparent 100%);
        }

        .overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 40;
            opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .overlay.active { opacity: 1; visibility: visible; }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed; top: 0; bottom: 0; left: 0;
                width: 280px; transform: translateX(-100%);
                box-shadow: 2px 0 15px rgba(0,0,0,0.1);
            }
            .sidebar.open { transform: translateX(0); }
            .menu-btn { display: block; }
            /* ç§»åŠ¨ç«¯å¤´éƒ¨è°ƒæ•´ */
            .sticky-header { padding-top: 80px; }
            .sidebar-footer { display: block; } 
        }
    </style>
</head>
<body>

    <div class="overlay" id="overlay"></div>

    <button class="menu-btn" id="menuBtn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </button>

    <aside class="sidebar" id="sidebar">
        <div class="profile">
            <img id="avatar" class="avatar" src="./favicon.ico" alt="Avatar">
            <div class="nickname" id="nick">å°é›·é¡¿</div>
            <a id="home-link" href="https://leidun.pp.ua" target="_blank" class="home-link">ğŸ”— My Blog</a>
        </div>
        <div class="song-list" id="list">
            <div style="padding:20px; text-align:center; color:#999">Loading...</div>
        </div>
        <div class="sidebar-footer">
            <a href="https://github.com/hohouman/Show-Your-9-Sing" target="_blank" class="repo-link">
                <svg height="16" width="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                Open Source
            </a>
        </div>
    </aside>

    <main class="main">
        <div class="sticky-header">
            <h2 id="title">è¯·é€‰æ‹©æ­Œæ›²</h2>
            <audio id="audio" controls></audio>
        </div>
        <div class="lyrics" id="lyrics"></div>
    </main>

    <script>
        // ================= é…ç½®åŒº =================
        const AVATAR_URL = "./favicon.ico"; 
        const NICKNAME = "å°é›·é¡¿"; 
        const HOME_PAGE_URL = "https://leidun.pp.ua"; 
        // =========================================

        document.getElementById('avatar').src = AVATAR_URL;
        document.getElementById('nick').innerText = NICKNAME;
        document.getElementById('home-link').href = HOME_PAGE_URL;

        const listEl = document.getElementById('list');
        const titleEl = document.getElementById('title');
        const audioEl = document.getElementById('audio');
        const lyricsEl = document.getElementById('lyrics');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const menuBtn = document.getElementById('menuBtn');

        function toggleMenu() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }
        menuBtn.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', toggleMenu);

        // åŠ è½½æ­Œæ›²åˆ—è¡¨
        fetch('./list.json')
            .then(res => res.json())
            .then(songs => {
                if(!songs || songs.length === 0) {
                    listEl.innerHTML = '<div style="padding:20px;text-align:center">src ç›®å½•ç©ºç©ºå¦‚ä¹Ÿ</div>';
                    return;
                }
                renderList(songs);

                // è‡ªåŠ¨åŠ è½½ç¬¬ä¸€é¦–
                if (songs.length > 0) {
                    const firstEl = listEl.children[0];
                    if (firstEl) {
                        play(songs[0], firstEl);
                    }
                }
            })
            .catch(() => {
                listEl.innerHTML = '<div style="padding:20px;color:red;text-align:center">âš ï¸ è¯·é…ç½®æ„å»ºå‘½ä»¤:<br>node scan.js</div>';
            });

        function renderList(songs) {
            listEl.innerHTML = '';
            songs.forEach(song => {
                const div = document.createElement('div');
                div.className = 'song-item';
                div.innerText = song.title; 
                div.onclick = () => {
                    play(song, div);
                    if (window.innerWidth <= 768) {
                        toggleMenu();
                    }
                };
                listEl.appendChild(div);
            });
        }

        function play(song, el) {
            document.querySelectorAll('.song-item').forEach(d => d.classList.remove('active'));
            el.classList.add('active');
            
            titleEl.innerText = song.title;
            audioEl.src = `./src/${song.file}`;
            
            // é»˜è®¤ä¸è°ƒç”¨ audioEl.play()
            
            lyricsEl.innerText = "æ­£åœ¨è¯»å–æ­Œè¯...";
            const lyricFileName = song.title + ".txt"; 
            
            fetch(`./src/${lyricFileName}`)
                .then(res => {
                    if (res.ok) return res.text();
                    throw new Error("æ— æ­Œè¯");
                })
                .then(text => lyricsEl.innerText = text)
                .catch(() => lyricsEl.innerText = "ï¼ˆæœªæ‰¾åˆ°åŒå .txt æ­Œè¯æ–‡ä»¶ï¼‰");
        }
    </script>
</body>
</html>
